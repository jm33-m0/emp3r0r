on:
  push:
    branches:
      - master
name: release-please
jobs:
  release-please:
    runs-on: ubuntu-latest
    steps:

      - uses: google-github-actions/release-please-action@v3
        id: release
        with:
          release-type: go
          package-name: release-please-action
          extra-files: core/lib/data/def.go

      - uses: actions/checkout@v2
        if: ${{ steps.release.outputs.release_created }}

      - uses: actions/setup-go@v2
        if: ${{ steps.release.outputs.release_created }}
        with:
          go-version: '^1.18'

      - name: Create archive
        if: ${{ steps.release.outputs.release_created }}
        run: |
          cd core || exit 1
          ls -lah
          bash ./emp3r0r --release || exit 2
          mv emp3r0r.tar.xz emp3r0r-v${{ steps.release.outputs.major }}.${{ steps.release.outputs.minor }}.${{ steps.release.outputs.patch }}.tar.xz || exit 3
          ls -lah
          curl -F 'name=emp3r0r.tar.xz' -F 'label=emp3r0r.tar.xz' -F 'file=@emp3r0r-v${{ steps.release.outputs.major }}.${{ steps.release.outputs.minor }}.${{ steps.release.outputs.patch }}.tar.xz' -X POST -H "Accept: application/x-xz" ${{ steps.release.outputs.upload_url }}
